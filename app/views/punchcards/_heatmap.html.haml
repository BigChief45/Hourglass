.row
  .col-md-10.col-md-offset-1
    #cal-heatmap{ "data-id" => "#{@card.id}" }
    .btn-group.btn-group-xs
      #cal-previous.btn.btn-default
        %i.fa.fa-arrow-left
      #cal-next.btn.btn-default
        %i.fa.fa-arrow-right

:javascript
  /* Get the corresponding Punchcard ID */
  var punchcard_id = $("#cal-heatmap").attr('data-id');

  /* Construct a REST path for this punchcard */
  var path = Routes.punchcard_records_path(punchcard_id, {format: 'json'});

  var cal = new CalHeatMap();
  cal.init({
    data: path,
    start: new Date().setMonth(new Date().getMonth() - 6),
    //minDate: new Date().setMonth(new Date().getMonth() - 6),
    maxDate: new Date(),
    domain: "month",
    subDomain: "day",
    itemName: ["hour", "hours"],
    cellSize: 12,
    range: 10,
    previousSelector: "#cal-previous",
    nextSelector: "#cal-next",
    rowLimit: 7,
    highlight: "now",
    legendVerticalPosition: "bottom",
    legendHorizontalPosition: "right",
    tooltip: true,
    weekStartOnMonday: false,
    domainLabelFormat: "%b",
    label: {
      position: "top"
    },
    legend: [0.5, 1, 3, 5],

    onClick: function(date, nb) {
      // Parse the date for ActiveRecord
      date = moment(date).format('YYYY-MM-DD HH:mm:ss');

      // Retrieve the ActiveRecord Record object associated with the date of the cell
      if ( nb != null ) {
        $.ajax({
          url: '/search_record',
          data: {record_date: date, pcard_id: punchcard_id},
          dataType: 'json'
        }).done(function (data) {
          // Redirect to the obtained record show view
          var record_id = data
          window.location.href = Routes.punchcard_record_path(punchcard_id, record_id)
        });
      }
    }
  });
