.row
    .col-md-12
        %h3
            = @card.name
            .btn-group.pull-right
                = link_to new_punchcard_record_path(@card), class: 'btn btn-sm btn-default' do
                    %i.fa.fa-calendar-check-o
                    Punch
                    
                = link_to [:edit, @card], class: 'btn btn-sm btn-default' do
                    %i.fa.fa-pencil
                    
                = link_to punchcard_path, method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-sm btn-danger' do
                    %i.fa.fa-trash

        %p.text-center= auto_link(@card.description)

        // INSERT CAL HEAT MAP
        .row
            .col-md-12
                .panel.panel-default
                    .panel-body
                        .row
                            .col-md-6.col-md-offset-1
                                #cal-heatmap{ "data-id" => "#{@card.id}" }
                                    :javascript
                                        /* Get the corresponding Punchcard ID */
                                        var punchcard_id = $("#cal-heatmap").attr('data-id');
                                        
                                        /* Construct a REST path for this punchcard */
                                        var path = Routes.punchcard_records_path(punchcard_id, {format: 'json'});
                                        
                                        var cal = new CalHeatMap();
                                        cal.init({
                                            data: path,
                                            start: new Date().setMonth(new Date().getMonth() - 6),
                                            minDate: new Date().setMonth(new Date().getMonth() - 6),
                                            maxDate: new Date(),
                                            domain: "month",
                                            subDomain: "day",
                                            itemName: ["hour", "hours"],
                                            cellSize: 12,
                                            range: 7,
                                            rowLimit: 7,
                                            legendVerticalPosition: "bottom",
                                            legendHorizontalPosition: "right",
                                            tooltip: true,
                                            weekStartOnMonday: false,
                                            domainLabelFormat: "%b",
                                            label: {
                                                position: "top"
                                            },
                                            legend: [1, 3, 5]
                                        });
                        
                        // STATS
                        .row.cal-footer
                            .col-md-6.cal-footer-column
                                .text-center
                                    %h5
                                        %small Total hours
                                    
                                    %big.lead
                                        = @card.total_hours
                                        hours
                                        
                                    %h5
                                        %small
                                            = @card.records.first.created_at.strftime("%B %d %Y")
                                            –
                                            = Time.current.strftime("%B %d %Y")
                                    
                            .col-md-6
                                .text-center
                                    %h5
                                        %small Total Entries
                                    
                                    %big.lead
                                        = @card.records.count
                                        entries
                                        
                                    %h5
                                        %small
                                            = @card.records.first.created_at.strftime("%B %d %Y")
                                            –
                                            = Time.current.strftime("%B %d %Y")
                        
        %hr
        
        #record_area
            %h3 Latest Records
            
            %ul.list-group
                - @records.each do |record|
                    %li.list-group-item
                        %h4.list-group-item-heading
                            = link_to record.date.strftime("%A %B %d %Y"), [@card, record]
                            %small
                                (
                                = record.hours
                                %i.fa.fa-clock-o
                                )
                            
                            .btn-group.pull-right
                                = link_to [:edit, @card, record], class: 'btn btn-xs btn-default' do
                                    %i.fa.fa-pencil
                                = link_to [@card, record], method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-xs btn-danger' do
                                    %i.fa.fa-trash
                        
                        .list-group-item-text
                            = simple_format h markdown(record.description)